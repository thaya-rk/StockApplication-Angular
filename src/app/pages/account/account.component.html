<app-navbar></app-navbar>

<div class="d-flex">

  <div class="container content-with-sidebar">
    <h2 class="mb-4">Account Overview</h2>

    <!-- Profile -->
    <div class="card mb-4">
      <div class="card-header">ðŸ‘¤ Profile</div>
      <div class="card-body" *ngIf="user">
        <p><strong>Name:</strong> {{ user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Phone:</strong> {{ user.mobileNumber }}</p>
      </div>
    </div>

    <!-- Balance -->
    <div class="card mb-4">
      <div class="card-header">ðŸ’° Available Balance</div>
      <div class="card-body">
        <h4>â‚¹{{ balance | number:'1.2-2' }}</h4>
      </div>
    </div>

    <!-- Deposit / Withdraw -->
    <div class="card mb-4">
      <div class="card-header">ðŸ’³ Deposit / Withdraw Funds</div>
      <div class="card-body">
        <input type="number" [(ngModel)]="amount" class="form-control mb-2" placeholder="Enter amount" />
        <button class="btn btn-success me-2" (click)="deposit()">Deposit</button>
        <button class="btn btn-danger" (click)="withdraw()">Withdraw</button>
        <p class="mt-2 text-success" *ngIf="message">{{ message }}</p>
        <p class="mt-2 text-danger" *ngIf="error">{{ error }}</p>
      </div>
    </div>

    <!-- Ledger -->
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        ðŸ“˜ Ledger

        <!-- Toggle Filter -->
        <div class="btn-group btn-group-sm" role="group">
          <button class="btn btn-outline-primary" [class.active]="filter === 'ALL'" (click)="filter = 'ALL'">All</button>
          <button class="btn btn-outline-success" [class.active]="filter === 'FUNDS'" (click)="filter = 'FUNDS'">Deposit / Withdraw</button>
          <button class="btn btn-outline-info" [class.active]="filter === 'STOCKS'" (click)="filter = 'STOCKS'">Buy / Sell</button>
        </div>
      </div>

      <!-- Ledger Content -->
      <div class="list-group list-group-flush" *ngIf="filteredLedger().length > 0">
        <div class="list-group-item" *ngFor="let txn of filteredLedgerLimited()">
          <div class="row">
            <!-- Only for STOCK-related transactions -->
            <ng-container *ngIf="txn.type !== 'DEPOSIT' && txn.type !== 'WITHDRAW'">
              <div class="col-md-6 col-lg-4 mb-2">
                <strong>Company:</strong> {{ txn.stock?.companyName }}
              </div>
              <div class="col-md-6 col-lg-4 mb-2">
                <strong>Exchange:</strong> {{ txn.stock?.exchange }}
              </div>
              <div class="col-md-6 col-lg-4 mb-2">
                <strong>Stock Price:</strong> â‚¹{{ txn.stock?.stockPrice }}
              </div>
            </ng-container>

            <!-- Common fields -->
            <div class="col-md-6 col-lg-4 mb-2">
              <strong>Status:</strong> {{ txn.status }}
            </div>
            <div class="col-md-6 col-lg-4 mb-2">
              <strong>Type:</strong> {{ txn.type }}
            </div>
            <div class="col-md-6 col-lg-4 mb-2">
              <strong>Date:</strong> {{ txn.transactionDate | date:'short' }}
            </div>
            <div class="col-md-6 col-lg-4 mb-2">
              <strong>Amount:</strong> â‚¹{{ txn.totalAmount }}
            </div>
          </div>
        </div>
      </div>

      <!-- Expand/Collapse Button -->
      <div *ngIf="filteredLedger().length > 5" class="text-center my-3">
        <button class="btn btn-outline-secondary" (click)="showAllTransactions = !showAllTransactions">
          {{ showAllTransactions ? 'Show Less' : 'Show All' }}
        </button>
      </div>

      <!-- No Transactions -->
      <div *ngIf="filteredLedger().length === 0" class="text-muted p-3">
        No transactions found for the selected filter.
      </div>
    </div>
  </div>
</div>
